<!-- article.html -->

#{extends 'main.html' /}
#{set title:'Article Detail' /}
<div class="span12">
	<div class="well">
		<h2>${article.title}</h2>
		<div class="summary">
			${article.summary}
		</div>
	</div>
	<div class="row-fluid">
		<div class="span12">
			<img class="pull-right headerPic" src="${article.headerPicUrl}"/>
			<blockquote class="entry">
				${article.entry.raw()}
			</blockquote>
		</div>
	</div>
	
	<div class="row-fluid" style="margin-top: 100px;">
		<div class="span2">
			#{list items:article.tags, as:'tag'}
			${tag.tagName}<br/>
			#{/list}
		</div>
		<div class="span7">
			<h2>Overall Rating: ${article.avgScore==0 ? "not rated yet" : article.avgScore + " /5"}</h2>
			
			#{form @Articles.rateArticle()}
				<div class="row-fluid">
					<div class="span4">
						<h3>
							Writing Style
						</h3>
						<div class="control-group">
							<label class="control-label">
								How well was the article written?
							</label>
							<div class="controls">
								<div class="star" data-category="writingStyle"></div>
							</div>
						</div>
					</div>
					<div class="span4">
						<h3>
							Non-Alignment
						</h3>
						<div class="control-group">
							<label class="control-label">
								How non-aligned was the article?
							</label>
							<div class="controls">
								<div class="star" data-category="nonAlignment"></div>
							</div>
						</div>
					</div>
					<div class="span4">
						<h3>
							Overall
						</h3>
						<div class="control-group">
							<label class="control-label">
							Overall, how did you like the article?
							</label>
							<div class="controls">
								<div class="star" data-category="overall"></div>
							</div>
						</div>
					</div>
				</div>
			#{/form}
		</div>
		<div class="span3">
			<h2>
				Statistics and Information
			</h2>
    		<div>Pageviews: 123</div>
            <div>Published on: ${article.postedAt.format('dd.MM.yyyy HH:mm')}</div>
            <div>Permalink: <input type="text" class="input-large" readonly value="@@{Articles.getArticle(article.id)}"/></div>
        </div>
	</div>
	

</div>

<script>
	//global var
	ARTICLE_ID = ${article.id};
	LOGGED_IN = ${session["loggedin"]};
	
	$(function () {
	    $('.star').each(function () {
	        var category = $(this).attr('data-category');
	        $(this).raty({
	            path: '/public/assets/img/',
	            scoreName: category,
	            click: function (score) {
	                
	                //if (LOGGED_IN == "true") {
	                    console && console.log('rating article #%d with %d points in category %s', ARTICLE_ID, score, category);
	                    $.post('@@{Articles.rateArticle()}', {
	                        articleId: ARTICLE_ID,
	                        score: score,
	                        category: category
	                    }, function (e) {
	                        console && console.log(e); // log response
	                    });
	               // }
	            }
	        });
	    });
	});
</script>